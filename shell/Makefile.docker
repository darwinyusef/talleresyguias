# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# MAKEFILE - CONFIGURACIÃ“N Y GESTIÃ“N DE DOCKER
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Este Makefile automatiza la instalaciÃ³n y gestiÃ³n de Docker
# Uso: make -f Makefile.docker <target>
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

.PHONY: help install uninstall info containers images networks volumes build run stop clean prune compose

# Variables
DOCKER_IMAGE_NAME := mi-app
DOCKER_CONTAINER_NAME := mi-container
DOCKER_TAG := latest
DOCKER_PORT_HOST := 8080
DOCKER_PORT_CONTAINER := 80

# Detectar sistema operativo
UNAME_S := $(shell uname -s)
ifeq ($(UNAME_S),Linux)
    OS := Linux
endif
ifeq ($(UNAME_S),Darwin)
    OS := macOS
endif

# Colores
GREEN := \033[0;32m
YELLOW := \033[0;33m
RED := \033[0;31m
BLUE := \033[0;34m
CYAN := \033[0;36m
NC := \033[0m

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# AYUDA
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

help:
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo "  DOCKER - GESTIÃ“N Y CONFIGURACIÃ“N"
	@echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	@echo "Sistema detectado: $(OS)"
	@echo ""
	@echo "$(BLUE)â–¸ InstalaciÃ³n:$(NC)"
	@echo "  $(GREEN)make install$(NC)           - Instalar Docker"
	@echo "  $(GREEN)make uninstall$(NC)         - Desinstalar Docker"
	@echo "  $(GREEN)make info$(NC)              - InformaciÃ³n de Docker"
	@echo ""
	@echo "$(BLUE)â–¸ Contenedores:$(NC)"
	@echo "  $(GREEN)make containers$(NC)        - Listar contenedores"
	@echo "  $(GREEN)make ps$(NC)                - Contenedores activos"
	@echo "  $(GREEN)make ps-all$(NC)            - Todos los contenedores"
	@echo "  $(GREEN)make stop-all$(NC)          - Detener todos los contenedores"
	@echo "  $(GREEN)make rm-all$(NC)            - Eliminar todos los contenedores"
	@echo ""
	@echo "$(BLUE)â–¸ ImÃ¡genes:$(NC)"
	@echo "  $(GREEN)make images$(NC)            - Listar imÃ¡genes"
	@echo "  $(GREEN)make pull$(NC)              - Descargar imagen (IMAGE=nombre:tag)"
	@echo "  $(GREEN)make rmi$(NC)               - Eliminar imagen (IMAGE=nombre)"
	@echo "  $(GREEN)make build-example$(NC)     - Construir imagen de ejemplo"
	@echo ""
	@echo "$(BLUE)â–¸ Redes y VolÃºmenes:$(NC)"
	@echo "  $(GREEN)make networks$(NC)          - Listar redes"
	@echo "  $(GREEN)make volumes$(NC)           - Listar volÃºmenes"
	@echo ""
	@echo "$(BLUE)â–¸ Docker Compose:$(NC)"
	@echo "  $(GREEN)make compose-up$(NC)        - Levantar servicios"
	@echo "  $(GREEN)make compose-down$(NC)      - Detener servicios"
	@echo "  $(GREEN)make compose-logs$(NC)      - Ver logs"
	@echo "  $(GREEN)make compose-example$(NC)   - Crear docker-compose.yml de ejemplo"
	@echo ""
	@echo "$(BLUE)â–¸ Ejemplos RÃ¡pidos:$(NC)"
	@echo "  $(GREEN)make nginx$(NC)             - Ejecutar Nginx"
	@echo "  $(GREEN)make postgres$(NC)          - Ejecutar PostgreSQL"
	@echo "  $(GREEN)make redis$(NC)             - Ejecutar Redis"
	@echo "  $(GREEN)make mongo$(NC)             - Ejecutar MongoDB"
	@echo ""
	@echo "$(BLUE)â–¸ Limpieza:$(NC)"
	@echo "  $(GREEN)make clean$(NC)             - Limpiar contenedores detenidos"
	@echo "  $(GREEN)make prune$(NC)             - Limpieza profunda del sistema"
	@echo "  $(GREEN)make prune-all$(NC)         - Eliminar TODO (Â¡cuidado!)"
	@echo ""
	@echo "$(BLUE)â–¸ Utilidades:$(NC)"
	@echo "  $(GREEN)make stats$(NC)             - EstadÃ­sticas de recursos"
	@echo "  $(GREEN)make logs$(NC)              - Ver logs (CONTAINER=nombre)"
	@echo "  $(GREEN)make exec$(NC)              - Ejecutar comando (CONTAINER=nombre CMD=comando)"
	@echo "  $(GREEN)make shell$(NC)             - Abrir shell (CONTAINER=nombre)"
	@echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# INSTALACIÃ“N
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

install:
	@echo "$(BLUE)â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo "$(BLUE)  Instalando Docker en $(OS)$(NC)"
	@echo "$(BLUE)â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo ""
ifeq ($(OS),Linux)
	@echo "$(YELLOW)â†’ Actualizando paquetes...$(NC)"
	@sudo apt-get update
	@echo ""
	@echo "$(YELLOW)â†’ Instalando dependencias...$(NC)"
	@sudo apt-get install -y apt-transport-https ca-certificates curl software-properties-common
	@echo ""
	@echo "$(YELLOW)â†’ AÃ±adiendo clave GPG de Docker...$(NC)"
	@curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
	@echo ""
	@echo "$(YELLOW)â†’ AÃ±adiendo repositorio de Docker...$(NC)"
	@echo "deb [arch=$$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $$(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
	@sudo apt-get update
	@echo ""
	@echo "$(YELLOW)â†’ Instalando Docker...$(NC)"
	@sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin
	@echo ""
	@echo "$(YELLOW)â†’ AÃ±adiendo usuario al grupo docker...$(NC)"
	@sudo usermod -aG docker $$USER
	@echo ""
	@echo "$(YELLOW)â†’ Habilitando Docker al inicio...$(NC)"
	@sudo systemctl enable docker
	@sudo systemctl start docker
endif
ifeq ($(OS),macOS)
	@echo "$(YELLOW)â†’ Verificando Homebrew...$(NC)"
	@command -v brew > /dev/null || (echo "$(RED)âœ— Homebrew no instalado$(NC)" && exit 1)
	@echo ""
	@echo "$(YELLOW)â†’ Instalando Docker Desktop con Homebrew...$(NC)"
	@brew install --cask docker
	@echo ""
	@echo "$(YELLOW)â†’ Iniciando Docker Desktop...$(NC)"
	@open -a Docker
	@echo ""
	@echo "$(YELLOW)â³ Esperando a que Docker Desktop inicie...$(NC)"
	@sleep 10
endif
	@echo ""
	@echo "$(GREEN)â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo "$(GREEN)  âœ“ Docker instalado exitosamente$(NC)"
	@echo "$(GREEN)â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo ""
	@docker --version
	@docker compose version 2>/dev/null || docker-compose --version
	@echo ""
ifeq ($(OS),Linux)
	@echo "$(YELLOW)âš  Nota: Reinicia tu sesiÃ³n para aplicar permisos del grupo docker$(NC)"
endif

uninstall:
	@echo "$(RED)Desinstalando Docker...$(NC)"
ifeq ($(OS),Linux)
	@sudo apt-get purge -y docker-ce docker-ce-cli containerd.io docker-compose-plugin
	@sudo rm -rf /var/lib/docker
	@sudo rm -rf /var/lib/containerd
endif
ifeq ($(OS),macOS)
	@brew uninstall --cask docker
endif
	@echo "$(GREEN)âœ“ Docker desinstalado$(NC)"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# INFORMACIÃ“N
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

info:
	@echo "$(BLUE)â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo "$(BLUE)  INFORMACIÃ“N DE DOCKER$(NC)"
	@echo "$(BLUE)â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo ""
	@docker --version
	@docker compose version 2>/dev/null || docker-compose --version
	@echo ""
	@echo "$(CYAN)--- Sistema ---$(NC)"
	@docker system info | grep -E "Server Version|Storage Driver|Operating System|OSType|Architecture|CPUs|Total Memory"
	@echo ""
	@echo "$(CYAN)--- Uso de disco ---$(NC)"
	@docker system df
	@echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# CONTENEDORES
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

containers: ps

ps:
	@echo "$(CYAN)â•â•â•â• Contenedores Activos â•â•â•â•$(NC)"
	@docker ps

ps-all:
	@echo "$(CYAN)â•â•â•â• Todos los Contenedores â•â•â•â•$(NC)"
	@docker ps -a

stop-all:
	@echo "$(YELLOW)â†’ Deteniendo todos los contenedores...$(NC)"
	@docker stop $$(docker ps -q) 2>/dev/null || echo "No hay contenedores activos"

rm-all:
	@echo "$(RED)â†’ Eliminando todos los contenedores...$(NC)"
	@docker rm -f $$(docker ps -aq) 2>/dev/null || echo "No hay contenedores para eliminar"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# IMÃGENES
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

images:
	@echo "$(CYAN)â•â•â•â• ImÃ¡genes Disponibles â•â•â•â•$(NC)"
	@docker images

pull:
	@echo "$(YELLOW)â†’ Descargando imagen $(IMAGE)...$(NC)"
	@docker pull $(IMAGE)

rmi:
	@echo "$(RED)â†’ Eliminando imagen $(IMAGE)...$(NC)"
	@docker rmi $(IMAGE)

build-example:
	@echo "$(YELLOW)â†’ Creando Dockerfile de ejemplo...$(NC)"
	@mkdir -p docker-example
	@echo 'FROM nginx:alpine' > docker-example/Dockerfile
	@echo 'COPY index.html /usr/share/nginx/html/' >> docker-example/Dockerfile
	@echo 'EXPOSE 80' >> docker-example/Dockerfile
	@echo '<!DOCTYPE html>' > docker-example/index.html
	@echo '<html>' >> docker-example/index.html
	@echo '<head><title>Docker Example</title></head>' >> docker-example/index.html
	@echo '<body>' >> docker-example/index.html
	@echo '  <h1>ğŸ³ Hola desde Docker!</h1>' >> docker-example/index.html
	@echo '  <p>Este contenedor fue creado con Makefile</p>' >> docker-example/index.html
	@echo '</body>' >> docker-example/index.html
	@echo '</html>' >> docker-example/index.html
	@echo ""
	@echo "$(YELLOW)â†’ Construyendo imagen...$(NC)"
	@docker build -t $(DOCKER_IMAGE_NAME):$(DOCKER_TAG) docker-example/
	@echo ""
	@echo "$(GREEN)âœ“ Imagen construida: $(DOCKER_IMAGE_NAME):$(DOCKER_TAG)$(NC)"
	@echo ""
	@echo "$(CYAN)Para ejecutar:$(NC) make run-example"

run-example:
	@echo "$(YELLOW)â†’ Ejecutando contenedor...$(NC)"
	@docker run -d --name $(DOCKER_CONTAINER_NAME) -p $(DOCKER_PORT_HOST):$(DOCKER_PORT_CONTAINER) $(DOCKER_IMAGE_NAME):$(DOCKER_TAG)
	@echo ""
	@echo "$(GREEN)âœ“ Contenedor ejecutÃ¡ndose$(NC)"
	@echo "$(CYAN)URL:$(NC) http://localhost:$(DOCKER_PORT_HOST)"
	@echo "$(CYAN)Ver logs:$(NC) make logs CONTAINER=$(DOCKER_CONTAINER_NAME)"
	@echo "$(CYAN)Detener:$(NC) docker stop $(DOCKER_CONTAINER_NAME)"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# REDES Y VOLÃšMENES
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

networks:
	@echo "$(CYAN)â•â•â•â• Redes de Docker â•â•â•â•$(NC)"
	@docker network ls

volumes:
	@echo "$(CYAN)â•â•â•â• VolÃºmenes de Docker â•â•â•â•$(NC)"
	@docker volume ls

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# EJEMPLOS RÃPIDOS
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

nginx:
	@echo "$(YELLOW)â†’ Ejecutando Nginx...$(NC)"
	@docker run -d --name nginx-server -p 8080:80 nginx:alpine
	@echo "$(GREEN)âœ“ Nginx corriendo en http://localhost:8080$(NC)"

postgres:
	@echo "$(YELLOW)â†’ Ejecutando PostgreSQL...$(NC)"
	@docker run -d --name postgres-db \
		-e POSTGRES_PASSWORD=secret \
		-e POSTGRES_USER=admin \
		-e POSTGRES_DB=mydb \
		-p 5432:5432 \
		postgres:alpine
	@echo "$(GREEN)âœ“ PostgreSQL corriendo en localhost:5432$(NC)"
	@echo "$(CYAN)Usuario:$(NC) admin"
	@echo "$(CYAN)Password:$(NC) secret"
	@echo "$(CYAN)Base de datos:$(NC) mydb"

redis:
	@echo "$(YELLOW)â†’ Ejecutando Redis...$(NC)"
	@docker run -d --name redis-cache -p 6379:6379 redis:alpine
	@echo "$(GREEN)âœ“ Redis corriendo en localhost:6379$(NC)"

mongo:
	@echo "$(YELLOW)â†’ Ejecutando MongoDB...$(NC)"
	@docker run -d --name mongodb \
		-e MONGO_INITDB_ROOT_USERNAME=admin \
		-e MONGO_INITDB_ROOT_PASSWORD=secret \
		-p 27017:27017 \
		mongo:latest
	@echo "$(GREEN)âœ“ MongoDB corriendo en localhost:27017$(NC)"
	@echo "$(CYAN)Usuario:$(NC) admin"
	@echo "$(CYAN)Password:$(NC) secret"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# DOCKER COMPOSE
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

compose-example:
	@echo "$(YELLOW)â†’ Creando docker-compose.yml de ejemplo...$(NC)"
	@echo 'version: "3.8"' > docker-compose.yml
	@echo '' >> docker-compose.yml
	@echo 'services:' >> docker-compose.yml
	@echo '  web:' >> docker-compose.yml
	@echo '    image: nginx:alpine' >> docker-compose.yml
	@echo '    ports:' >> docker-compose.yml
	@echo '      - "8080:80"' >> docker-compose.yml
	@echo '    volumes:' >> docker-compose.yml
	@echo '      - ./html:/usr/share/nginx/html' >> docker-compose.yml
	@echo '' >> docker-compose.yml
	@echo '  db:' >> docker-compose.yml
	@echo '    image: postgres:alpine' >> docker-compose.yml
	@echo '    environment:' >> docker-compose.yml
	@echo '      POSTGRES_PASSWORD: secret' >> docker-compose.yml
	@echo '      POSTGRES_USER: admin' >> docker-compose.yml
	@echo '      POSTGRES_DB: mydb' >> docker-compose.yml
	@echo '    ports:' >> docker-compose.yml
	@echo '      - "5432:5432"' >> docker-compose.yml
	@echo '    volumes:' >> docker-compose.yml
	@echo '      - postgres_data:/var/lib/postgresql/data' >> docker-compose.yml
	@echo '' >> docker-compose.yml
	@echo '  cache:' >> docker-compose.yml
	@echo '    image: redis:alpine' >> docker-compose.yml
	@echo '    ports:' >> docker-compose.yml
	@echo '      - "6379:6379"' >> docker-compose.yml
	@echo '' >> docker-compose.yml
	@echo 'volumes:' >> docker-compose.yml
	@echo '  postgres_data:' >> docker-compose.yml
	@mkdir -p html
	@echo '<h1>ğŸ³ Docker Compose Stack</h1>' > html/index.html
	@echo '<p>Nginx + PostgreSQL + Redis</p>' >> html/index.html
	@echo ""
	@echo "$(GREEN)âœ“ docker-compose.yml creado$(NC)"
	@echo ""
	@echo "$(CYAN)Comandos:$(NC)"
	@echo "  make compose-up    - Levantar servicios"
	@echo "  make compose-down  - Detener servicios"

compose-up:
	@echo "$(YELLOW)â†’ Levantando servicios con Docker Compose...$(NC)"
	@docker compose up -d 2>/dev/null || docker-compose up -d
	@echo "$(GREEN)âœ“ Servicios levantados$(NC)"

compose-down:
	@echo "$(YELLOW)â†’ Deteniendo servicios...$(NC)"
	@docker compose down 2>/dev/null || docker-compose down
	@echo "$(GREEN)âœ“ Servicios detenidos$(NC)"

compose-logs:
	@docker compose logs -f 2>/dev/null || docker-compose logs -f

compose-ps:
	@docker compose ps 2>/dev/null || docker-compose ps

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# UTILIDADES
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

stats:
	@echo "$(CYAN)â•â•â•â• EstadÃ­sticas de Contenedores â•â•â•â•$(NC)"
	@docker stats --no-stream

logs:
	@echo "$(CYAN)â•â•â•â• Logs de $(CONTAINER) â•â•â•â•$(NC)"
	@docker logs $(CONTAINER)

logs-follow:
	@docker logs -f $(CONTAINER)

exec:
	@docker exec -it $(CONTAINER) $(CMD)

shell:
	@echo "$(CYAN)â†’ Abriendo shell en $(CONTAINER)...$(NC)"
	@docker exec -it $(CONTAINER) /bin/sh || docker exec -it $(CONTAINER) /bin/bash

inspect:
	@docker inspect $(CONTAINER)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# LIMPIEZA
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

clean:
	@echo "$(YELLOW)â†’ Limpiando contenedores detenidos...$(NC)"
	@docker container prune -f
	@echo "$(GREEN)âœ“ Limpieza completada$(NC)"

prune:
	@echo "$(YELLOW)â†’ Limpieza profunda del sistema Docker...$(NC)"
	@docker system prune -f
	@echo "$(GREEN)âœ“ Sistema limpiado$(NC)"

prune-all:
	@echo "$(RED)âš  ADVERTENCIA: Esto eliminarÃ¡ TODO (contenedores, imÃ¡genes, volÃºmenes, redes)$(NC)"
	@echo "$(RED)Â¿EstÃ¡s seguro? [y/N]$(NC)"
	@read -p "" confirm && [ "$$confirm" = "y" ] || exit 1
	@docker system prune -a --volumes -f
	@echo "$(GREEN)âœ“ Sistema completamente limpiado$(NC)"

clean-images:
	@echo "$(YELLOW)â†’ Eliminando imÃ¡genes sin usar...$(NC)"
	@docker image prune -a -f

clean-volumes:
	@echo "$(YELLOW)â†’ Eliminando volÃºmenes sin usar...$(NC)"
	@docker volume prune -f

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# STACK COMPLETO DE DESARROLLO
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

dev-stack:
	@echo "$(BLUE)â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo "$(BLUE)  Creando Stack de Desarrollo Completo$(NC)"
	@echo "$(BLUE)â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo ""
	@echo "$(YELLOW)â†’ Creando docker-compose para desarrollo...$(NC)"
	@echo 'version: "3.8"' > docker-compose.dev.yml
	@echo '' >> docker-compose.dev.yml
	@echo 'services:' >> docker-compose.dev.yml
	@echo '  nginx:' >> docker-compose.dev.yml
	@echo '    image: nginx:alpine' >> docker-compose.dev.yml
	@echo '    container_name: dev-nginx' >> docker-compose.dev.yml
	@echo '    ports:' >> docker-compose.dev.yml
	@echo '      - "80:80"' >> docker-compose.dev.yml
	@echo '    volumes:' >> docker-compose.dev.yml
	@echo '      - ./app:/usr/share/nginx/html' >> docker-compose.dev.yml
	@echo '    networks:' >> docker-compose.dev.yml
	@echo '      - dev-network' >> docker-compose.dev.yml
	@echo '' >> docker-compose.dev.yml
	@echo '  postgres:' >> docker-compose.dev.yml
	@echo '    image: postgres:14-alpine' >> docker-compose.dev.yml
	@echo '    container_name: dev-postgres' >> docker-compose.dev.yml
	@echo '    environment:' >> docker-compose.dev.yml
	@echo '      POSTGRES_USER: developer' >> docker-compose.dev.yml
	@echo '      POSTGRES_PASSWORD: devpass123' >> docker-compose.dev.yml
	@echo '      POSTGRES_DB: devdb' >> docker-compose.dev.yml
	@echo '    ports:' >> docker-compose.dev.yml
	@echo '      - "5432:5432"' >> docker-compose.dev.yml
	@echo '    volumes:' >> docker-compose.dev.yml
	@echo '      - postgres_data:/var/lib/postgresql/data' >> docker-compose.dev.yml
	@echo '    networks:' >> docker-compose.dev.yml
	@echo '      - dev-network' >> docker-compose.dev.yml
	@echo '' >> docker-compose.dev.yml
	@echo '  redis:' >> docker-compose.dev.yml
	@echo '    image: redis:alpine' >> docker-compose.dev.yml
	@echo '    container_name: dev-redis' >> docker-compose.dev.yml
	@echo '    ports:' >> docker-compose.dev.yml
	@echo '      - "6379:6379"' >> docker-compose.dev.yml
	@echo '    networks:' >> docker-compose.dev.yml
	@echo '      - dev-network' >> docker-compose.dev.yml
	@echo '' >> docker-compose.dev.yml
	@echo 'networks:' >> docker-compose.dev.yml
	@echo '  dev-network:' >> docker-compose.dev.yml
	@echo '    driver: bridge' >> docker-compose.dev.yml
	@echo '' >> docker-compose.dev.yml
	@echo 'volumes:' >> docker-compose.dev.yml
	@echo '  postgres_data:' >> docker-compose.dev.yml
	@mkdir -p app
	@echo '<h1>ğŸš€ Stack de Desarrollo</h1>' > app/index.html
	@echo '<p>Nginx + PostgreSQL + Redis</p>' >> app/index.html
	@echo ""
	@echo "$(GREEN)âœ“ Stack de desarrollo creado$(NC)"
	@echo ""
	@docker compose -f docker-compose.dev.yml up -d 2>/dev/null || docker-compose -f docker-compose.dev.yml up -d
	@echo ""
	@echo "$(GREEN)â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo "$(GREEN)  âœ“ Stack de desarrollo levantado$(NC)"
	@echo "$(GREEN)â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo ""
	@echo "$(CYAN)Servicios disponibles:$(NC)"
	@echo "  â€¢ Nginx:      http://localhost"
	@echo "  â€¢ PostgreSQL: localhost:5432 (user: developer, pass: devpass123)"
	@echo "  â€¢ Redis:      localhost:6379"
	@echo ""

dev-stack-down:
	@docker compose -f docker-compose.dev.yml down 2>/dev/null || docker-compose -f docker-compose.dev.yml down

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# DEFAULT
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

.DEFAULT_GOAL := help
